<!--http://127.0.0.1:8000/throwing_practice æ‹‹çƒç·´ç¿’-->
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <title>æ‹‹çƒç·´ç¿’</title>
     <!-- åœ–è¡¨æ’ä»¶ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- å…¨åŸŸæ¨£å¼èˆ‡ Reset -->
    <style>
        :root {
            --navbar-height: 60px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Noto Sans TC", "Segoe UI", sans-serif;
            background: #f2f2f2;
            margin: 0;
        }

        h1, h2 {
            color: #333;
        }

        p {
            font-size: 1.1em;
            color: #444;
            margin-bottom: 10px;
        }
    </style>

    <!-- å°è¦½åˆ—æ¨£å¼ -->
    <style>
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--navbar-height);
            background: linear-gradient(to right, #4facfe, #00f2fe);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            z-index: 999;
        }

        .navbar .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
        }

        .navbar .nav-links {
            display: flex;
            gap: 20px;
        }

        .navbar a {
            text-decoration: none;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            transition: background 0.3s;
        }

        .navbar a:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .nav-links a:hover {
            color: #4CAF50;
        }
    </style>

    <!-- å…§å®¹å€åŸŸæ¨£å¼ -->
    <style>
        .content {
            margin-top: calc(var(--navbar-height) + 20px);
            padding: 60px 20px;
            position: relative;
            background: radial-gradient(circle at center, #eaffea 0%, #ffffff 100%);
            overflow: hidden;
        }

        .main-content {
            position: relative;
            z-index: 1;
        }
    </style>

    <!-- å‹•æ…‹èƒŒæ™¯åœ“å½¢ -->
    <style>
        .circle {
            position: absolute;
            border-radius: 50%;
            opacity: 0.3;
            animation: float 6s ease-in-out infinite;
            z-index: 0;
        }

        .circle.green {
            background-color: #A5D6A7;
        }

        .circle.white {
            background-color: #F1F8E9;
        }

        .circle1 {
            width: 120px;
            height: 120px;
            top: 20%;
            left: 10%;
            animation-delay: 0s;
        }

        .circle2 {
            width: 200px;
            height: 200px;
            top: 60%;
            left: 70%;
            animation-delay: 2s;
        }

        .circle3 {
            width: 80px;
            height: 80px;
            top: 40%;
            left: 50%;
            animation-delay: 4s;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0px) rotate(0deg);
            }
            50% {
                transform: translateY(-30px) rotate(360deg);
            }
        }
    </style>

    <!-- åœ–è¡¨å€æ¨£å¼ -->
    <style>
        .charts {
            display: flex;
            flex-wrap: nowrap;/* ä¸å…è¨±æ›è¡Œ */
            gap: 30px;
            /*justify-content: center;*/ /* è®“è£¡é¢çš„åœ–è¡¨é ä¸­ */
        }
        .charts > div {
            background: #f5f5f5;      /* èƒŒæ™¯ç°ç™½ä¸€é»ï¼Œé¿å…å¤ªæ·± */
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        canvas {
            max-width: 400px;
            margin-top: 30px;
        }
    </style>

    <!-- ğŸ“„ è¡¨æ ¼æ¨£å¼ -->
    <style>
        table {
            border-collapse: collapse;
            width: 100%;
            margin-top: 30px;
        }

        th, td {
            border: 1px solid #aaa;
            padding: 8px;
            text-align: center;
        }

        th {
            background-color: #ddd;
        }
    </style>
</head>
<body>
    <div class="navbar">
        <div class="logo">ç¶²çƒåŠ©æ‰‹</div>
        <div class="nav-links">
            <a href="index">é¦–é </a>
            <a href="rules">è¦å‰‡è§£èªª</a>
            <a href="score">è¨˜åˆ†æ¿</a>
            <a href="videos">å½±ç‰‡è§£èªª</a>
            <a href="wall_training">å°ç‰†ç·´ç¿’</a>
            <a href="serve_practice">ç™¼çƒç·´ç¿’</a>
            <a href="swing_practice">æ®æ‹ç·´ç¿’</a>
            <a href="throwing_practice">æ‹‹çƒç·´ç¿’</a>
            <a href="chatroom">èŠå¤©å®¤</a>
        </div>
    </div>
    <div class="content">
            <!-- å‹•æ…‹èƒŒæ™¯åœ“å½¢ -->
        <div class="circle green circle1"></div>
        <div class="circle white circle2"></div>
        <div class="circle green circle3"></div>
        <div class="main-content">
        <h1>ğŸ¾ æ‹‹çƒç·´ç¿’ç´€éŒ„</h1>
        
        <div class="charts">
            <div>
                <h2>æ‹‹çƒæˆåŠŸèˆ‡å¤±æ•—</h2>
                <canvas id="successChart"></canvas>
            </div>
            <div>
                <h2>æ‹‹çƒä½ç½®åˆ†å¸ƒ</h2>
                <canvas id="scatterChart"></canvas>
            </div>
            <div>
                <h2>æ‹‹çƒèª¤å·®</h2>
                <canvas id="heightChart"></canvas>
            </div>
        </div>

        <h2>ç³»çµ±ç¸½çµè©•èª</h2>
        <p>
            {% set comments = {} %}
            {% set counts = namespace(elbow_error=0, waist_error=0, hand_foot_error=0) %}
            {% set total_records = data.records | length %}

            {% for r in data.records %}
                {% set elbow_ok = 167 <= r.posture_reminder.swing_posture.elbow_straight <= 173 %}
                {% set waist_ok = r.posture_reminder.swing_posture.waist_straight > 40 %}
                {% set hand_foot_ok = r.posture_reminder.dominant_hand_and_foot.dominant_hand == 'right'
                    and r.posture_reminder.dominant_hand_and_foot.front_foot == 'left' %}

                {% if not elbow_ok %}
                    {% set counts.elbow_error = counts.elbow_error + 1 %}
                {% endif %}
                {% if not waist_ok %}
                    {% set counts.waist_error = counts.waist_error + 1 %}
                {% endif %}
                {% if not hand_foot_ok %}
                    {% set counts.hand_foot_error = counts.hand_foot_error + 1 %}
                {% endif %}

                {% if elbow_ok and waist_ok and r.throw_successful %}
                    {% set comment = "å§¿å‹¢ç©©å®šï¼Œæ‹‹çƒæˆåŠŸï¼Œè¡¨ç¾è‰¯å¥½ã€‚" %}
                {% elif (elbow_ok or waist_ok) and r.throw_successful %}
                    {% set comment = "å§¿å‹¢éœ€å¾®èª¿ï¼Œä½†æˆåŠŸç‡é‚„ä¸éŒ¯ã€‚" %}
                {% elif elbow_ok and waist_ok %}
                    {% set comment = "å§¿å‹¢ä¸éŒ¯ä½†ç©©å®šåº¦éœ€åŠ å¼·ã€‚" %}
                {% else %}
                    {% set comment = "å§¿å‹¢éœ€è¦å†èª¿æ•´ã€‚" %}
                {% endif %}

                {% set _ = comments.update({comment: comments.get(comment, 0) + 1}) %}
            {% endfor %}

            {% set most_common = comments | dictsort(true, 'value') | first %}
            {% if most_common %}
                <strong>{{ most_common[0] }}</strong>
            {% else %}
                <strong>æ²’æœ‰æ•¸æ“š</strong>
            {% endif %}

            <p>æ‰‹è‚˜éŒ¯èª¤æ¬¡æ•¸ï¼š{{ counts.elbow_error }} / {{ total_records }}</p>
            <p>è…°éƒ¨éŒ¯èª¤æ¬¡æ•¸ï¼š{{ counts.waist_error }} / {{ total_records }}</p>
            <p>æ‰‹è…³éŒ¯èª¤æ¬¡æ•¸ï¼š{{ counts.hand_foot_error }} / {{ total_records }}</p>
        </p>

        <h3>å»ºè­°ï¼š</h3>
        <ul>
            {% if total_records > 0 and (counts.elbow_error / total_records) > 0.4 %}
                <li>æ‹‹çƒæ™‚ï¼Œæ‰‹è‚˜éœ€å†å¤šä¼¸ç›´ã€‚</li>
            {% endif %}
            {% if total_records > 0 and counts.waist_error / total_records > 0.4 %}
                <li>æ‹‹çƒæ™‚éœ€é…åˆè…°éƒ¨è½‰å‹•ï¼Œé¿å…åƒ…é æ‰‹è‡‚ç™¼åŠ›ã€‚</li>
            {% endif %}
            {% if total_records > 0 and counts.hand_foot_error / total_records > 0.4 %}
                <li>é å‚™å‹•ä½œï¼Œè«‹ç¶­æŒå·¦è…³åœ¨å‰ï¼Œå³è…³åœ¨å¾Œï¼Œä¿æŒå¹³è¡¡ã€‚</li>
            {% endif %}

            {% if total_records > 0 and counts.elbow_error / total_records <= 0.4
                and counts.waist_error / total_records <= 0.4
                and counts.hand_foot_error / total_records <= 0.4 %}
                <li>ç›®å‰æ²’æœ‰ç‰¹åˆ¥éœ€è¦èª¿æ•´çš„å»ºè­°ï¼Œè«‹æŒçºŒä¿æŒï¼</li>
            {% endif %}
        </ul>


        <h2>è©³ç´°ç´€éŒ„</h2>
        <table border="1" cellpadding="8" cellspacing="0">
            <thead>
                <tr>
                    <th>#</th>
                    <th>ç›®æ¨™é«˜åº¦ (m)</th>
                    <th>å¯¦éš› X ä½ç½® (m)</th>
                    <th>å¯¦éš› Y é«˜åº¦ (m)</th>
                    <th>æ‰‹è‚˜è§’åº¦ (167Â°~173Â°)</th>
                    <th>è…°éƒ¨è§’åº¦ (>40Â°)</th>
                    <th>æ…£ç”¨æ‰‹/å‰è…³</th>
                    <th>æ˜¯å¦æˆåŠŸ</th>
                </tr>
            </thead>
            <tbody>
                {% for r in data.records %}
                {% set elbow_angle = r.posture_reminder.swing_posture.elbow_straight %}
                {% set waist_angle = r.posture_reminder.swing_posture.waist_straight %}
                {% set elbow_ok = 167 <= elbow_angle <= 173 %}
                {% set waist_ok = waist_angle > 40 %}
                <tr>
                    <td>{{ loop.index }}</td>
                    <td>{{ "%.2f"|format(r.target_height) }}</td>
                    <td>{{ "%.2f"|format(r.current_position.x) }}</td>
                    <td>{{ "%.2f"|format(r.current_position.y) }}</td>
                    
                    <!-- æ‰‹è‚˜è§’åº¦ -->
                    <td>
                        {{ elbow_angle }}Â°
                        {{ 'âœ”ï¸' if elbow_ok else 'âŒ' }}
                    </td>
                    <!-- è…°éƒ¨è§’åº¦ -->
                    <td>
                        {{ waist_angle }}Â°
                        {{ 'âœ”ï¸' if waist_ok else 'âŒ' }}
                    </td>
                    <!-- æ…£ç”¨æ‰‹/å‰è…³ -->
                    <td>
                        {{ r.posture_reminder.dominant_hand_and_foot.dominant_hand }}/
                        {{ r.posture_reminder.dominant_hand_and_foot.front_foot }}
                    </td>
                    <!-- æ˜¯å¦æˆåŠŸ -->
                    <td>
                        {% if r.success %}
                            <span style="color: green;">âœ”ï¸ æˆåŠŸ</span>
                        {% else %}
                            <span style="color: red;">âŒ å¤±æ•—</span>
                        {% endif %}
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="8" style="text-align:center;color:#666;">æ²’æœ‰ç´€éŒ„</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    <!-- JSON è³‡æ–™ -->
    <script id="throwing-data" type="application/json">
        {{ data | tojson }}
    </script>
    <!-- åœ–è¡¨èˆ‡è³‡æ–™è™•ç† -->
    <script>
        // å¾ HTML å–å¾—è³‡æ–™
        const data = JSON.parse(document.getElementById("throwing-data").textContent);
        const records = data.records;
        const summary = data.summary;

        // æˆåŠŸ vs å¤±æ•— åœ“é¤…åœ–
        const ctxPie = document.getElementById('successChart').getContext('2d');
        new Chart(ctxPie, {
            type: 'pie',
            data: {
                labels: ['æˆåŠŸ', 'å¤±æ•—'],
                datasets: [{
                    data: [summary.success_count, summary.fail_count],
                    backgroundColor: ['#4caf50', '#f44336']
                }]
            },
            options: {
                responsive: true,
                plugins: {
                    title: {
                        display: true,
                        text: 'æ‹‹çƒæˆåŠŸ vs å¤±æ•—'
                    }
                }
            }
        });

        // æ‹‹çƒä½ç½®æ•£ä½ˆåœ–
        const scatterData = records.map(r => ({
            x: r.current_position.x,
            y: r.current_position.y
        }));
        const ctxScatter = document.getElementById('scatterChart').getContext('2d');
        new Chart(ctxScatter, {
            type: 'scatter',
            data: {
                datasets: [{
                    label: 'æ‹‹çƒä½ç½®',
                    data: scatterData,
                    backgroundColor: '#2196f3'
                }]
            },
            options: {
                scales: {
                    x: {
                        title: {
                            display: true,
                            text: 'X ä½ç½® (å…¬å°º)'
                        },
                        min: -0.6,
                        max: 0.6
                    },
                    y: {
                        title: {
                            display: true,
                            text: 'Y ä½ç½® / é«˜åº¦ (å…¬å°º)'
                        },
                        min: 1.0,
                        max: 3.0
                    }
                },
                plugins: {
                    title: {
                        display: true,
                        text: 'æ‹‹çƒå¯¦éš›ä½ç½®åˆ†å¸ƒåœ–'
                    }
                }
            }
        });

        // é«˜åº¦èª¤å·® é•·æ¢åœ–
        const ctxBar = document.getElementById('heightChart').getContext('2d');
        const heightDifferences = records.map((r, i) => ({
            x: `#${i + 1}`,
            y: Math.abs(r.current_position.y - r.target_height)
        }));

        new Chart(ctxBar, {
            type: 'bar',
            data: {
                labels: heightDifferences.map(p => p.x),
                datasets: [{
                    label: 'é«˜åº¦èª¤å·® (å…¬å°º)',
                    data: heightDifferences.map(p => p.y),
                    backgroundColor: '#ff9800'
                }]
            },
            options: {
                plugins: {
                    title: {
                        display: true,
                        text: 'æ¯æ¬¡æ‹‹çƒèˆ‡ç›®æ¨™é«˜åº¦çš„èª¤å·®'
                    }
                },
                scales: {
                    y: {
                        title: {
                            display: true,
                            text: 'èª¤å·® (å…¬å°º)'
                        }
                    }
                }
            }
        });

        // è¡¨æ ¼å…§å®¹å¡«å…¥
        /*
        const tbody = document.getElementById("recordTableBody");
        records.forEach((r, i) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
                <td>${i + 1}</td>
                <td>${r.target_height.toFixed(2)}</td>
                <td>${r.current_position.x.toFixed(2)}</td>
                <td>${r.current_position.y.toFixed(2)}</td>
                <td>${r.success ? "âœ…" : "âŒ"}</td>
            `;
            tbody.appendChild(tr);
        });
        */
    </script>

</body>
</html>